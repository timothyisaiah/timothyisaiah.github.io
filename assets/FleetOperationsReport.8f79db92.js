import{_ as R,e as O,ao as X,aL as T,m as W,f as Y,o as j,k as B,w as S,j as L,n as v,Q as C}from"./index.c5894f0b.js";import{Q}from"./QTable.3c8d771e.js";import{Q as $}from"./QPage.439cce40.js";import"./QItem.588ed55a.js";import"./position-engine.e8fba7f8.js";import"./format.865294d5.js";const z=[{name:"asset_name",label:"Asset Name",field:"asset_name"},{name:"driver_name",label:"Driver Name",field:"driver_name"},{name:"mileage_covered",label:"Mileage covered (KM)",field:"mileage_covered"},{name:"engine_runtime",label:"Engine Runtime [HH:mm:ss]",field:"engine_runtime"},{name:"idling_time",label:"Idling Time [HH:mm:ss]",field:"idling_time"},{name:"driving_time",label:"Driving Time [HH:mm:ss]",field:"driving_time"},{name:"parking_time",label:"Parking Time [HH:mm:ss]",field:"parking_time"},{name:"asset_utilization",label:"Asset Utilization [%]",field:"asset_utilization"},{name:"weekend_driving",label:"Weekend Driving",field:"weekend_driving"},{name:"weekend_mileage_covered",label:"Weekend Mileage Covered [Km]",field:"weekend_mileage_covered"},{name:"night_driving",label:"Night Driving",field:"night_driving"},{name:"night_mileage_covered",label:"Night Mileage Covered [Km]",field:"night_mileage_covered"},{name:"early_morning_driving",label:"Early Morning Driving",field:"early_morning_driving"},{name:"early_morning_mileage_covered",label:"Ealy Morning Mileage Covered [Km]",field:"early_morning_mileage_covered"},{name:"geofence_exit",label:"Geofence Exit/Entry",field:"geofence_exit"}],A=O({data(){return{columns:z,rows:[],loading:!0}},async mounted(){let r=X.findIn(this.getReports.activeReports),e=r[r.findIndex(i=>i.title==="Trip report")];e&&e.sheets=="Exceeded Memory Limit"&&await T.report.retreiveReport(e.id).then(i=>{e=i.report});let d=r[r.findIndex(i=>i.title==="Engine hours report")];if(e&&d){let i=e.sheets[0].sections[0].data,s=d.sheets[0].sections[0].data,m=this.dateDiffInDays(e.from,e.to,"days");for(let t=0;t<i.length;t++){let g=i[t].header,o=i[t].rows[0].object.v;if(i[t].rows.length>1)for(let n in i[t].rows)o=i[t].rows[n].object.v!=="Unidentified driver"?i[t].rows[n].object.v:i[t].rows[0].object.v;let u=i[t].rows[0].length,p=this.formatInHHMMSS(s[0].rows[t].in_movement.v,s[0].rows[t].idle.v),f=(s[0].rows[t].in_movement.raw,s[0].rows[t].idle.raw),_=s[0].rows[t].idle.v,E=s[0].rows[t].in_movement.v,F=i[t].rows[0].idle_duration.v,H=Number(f/(12*60*60*m)*100).toFixed(2),D="NO",w,y,b,k,I=0,M=0,N=0,c=0,x=0,h=0;if(e.sheets.findIndex(n=>n.header===g)>-1){let n=e.sheets[e.sheets.findIndex(l=>l.header===g)].sections[0].data;for(let l in n){if((n[l].header.includes("Sun")||n[l].header.includes("Sat"))&&(I+=parseInt(n[l].header.split(":")[1].trim()),n[l].rows.length>0))for(let a in n[l].rows)M+=n[l].rows[a].length.raw;if(n[l].rows.length>0)for(let a in n[l].rows)(parseInt(n[l].rows[a].from.v.split(":")[0])>19&&parseInt(n[l].rows[a].from.v.split(":")[0])<24||parseInt(n[l].rows[a].to.v.split(":")[0])>20&&parseInt(n[l].rows[a].to.v.split(":")[0])<24)&&(N++,c+=n[l].rows[a].length.raw),(parseInt(n[l].rows[a].from.v.split(":")[0])>=0&&parseInt(n[l].rows[a].from.v.split(":")[0])<6||parseInt(n[l].rows[a].to.v.split(":")[0])>0&&parseInt(n[l].rows[a].to.v.split(":")[0])<6)&&(x++,h+=n[l].rows[a].length.raw)}}w=Number(M).toFixed(2),y=I>0?"YES":"NO",c=Number(c).toFixed(2),b=N>0?"YES":"NO",h=Number(h).toFixed(2),k=x>0?"YES":"NO",this.rows.push({asset_name:g,driver_name:o,mileage_covered:u.v,engine_runtime:p,idling_time:_,driving_time:E,parking_time:F,asset_utilization:H,weekend_driving:y,weekend_mileage_covered:w,night_driving:b,night_mileage_covered:c,early_morning_driving:k,early_morning_mileage_covered:h,geofence_exit:D})}}this.loading=!1},computed:{...W("reports",["getReports"])},methods:{...Y("reports",["retreiveReport"]),dateDiffInDays(r,e,d){let i=1e3,s=i*60,m=s*60,t=m*24,g=t*7;r=new Date(r),e=new Date(e);let o=e-r;if(isNaN(o))return NaN;switch(d){case"years":return e.getFullYear()-r.getFullYear();case"months":return e.getFullYear()*12+e.getMonth()-(r.getFullYear()*12+r.getMonth());case"weeks":return Math.floor(o/g);case"days":return Math.floor(o/t);case"hours":return Math.floor(o/m);case"minutes":return Math.floor(o/s);case"seconds":return Math.floor(o/i);default:return}},formatInHHMMSS(r,e){let d=parseInt(r.split(":")[2]),i=parseInt(r.split(":")[1]),s=parseInt(r.split(":")[0]),m=parseInt(e.split(":")[2]),t=parseInt(e.split(":")[1]),g=parseInt(e.split(":")[0]),o=0,u=0,p=d+m;p>59&&(p=p%60,o=1);let f=i+t+o;f>59&&(f=f%60,u=1);let _=s+g+u;return Number.isNaN(_)?r:_+":"+f+":"+p},exportTable(){let r=[];for(let s in this.rows){let m=[];for(let t in this.columns)m[this.columns[t].label]=this.rows[s][this.columns[t].field];r.push(m)}let e="Fuel Report.xlsx",d=XLSX.utils.json_to_sheet(r),i=XLSX.utils.book_new();XLSX.utils.book_append_sheet(i,d,"myWorkSheet"),XLSX.writeFile(i,e)}}}),K={class:"full-width q-mt-md",align:"right"};function V(r,e,d,i,s,m){return j(),B($,{class:"full-screen bg-white"},{default:S(()=>[L("div",K,[v(C,{flat:"",onClick:e[0]||(e[0]=t=>this.$router.push("/home")),icon:"keyboard_arrow_left",class:"text-positive",title:"Back"})]),v(Q,{title:"Fleet Operations Report",rows:r.rows,columns:r.columns,"row-key":"asset_name",class:"sticky-column","rows-per-page-options":[10,20],loading:r.loading},{"top-right":S(()=>[v(C,{color:"primary","icon-right":"archive",label:"Export to xls","no-caps":"",onClick:r.exportTable},null,8,["onClick"])]),_:1},8,["rows","columns","loading"])]),_:1})}var ee=R(A,[["render",V]]);export{ee as default};

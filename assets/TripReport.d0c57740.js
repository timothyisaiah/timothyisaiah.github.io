import{_ as d,e as p,ao as _,aL as h,m as v,f as c,o as u,i as f,j as n,n as i,Q as m,w as g,F as w}from"./index.5b4c4d98.js";import{Q as b}from"./QTable.db5c137b.js";import"./QItem.0574e171.js";import"./position-engine.3072313b.js";import"./format.865294d5.js";const x=[{name:"asset_name",label:"Asset Name",field:"asset_name"},{name:"date",label:"Date",field:"date"},{name:"driver_name",label:"Driver Name",field:"driver_name"},{name:"movement_start",label:"Movement Start",field:"movement_start"},{name:"movement_end",label:"Movement End",field:"movement_end"},{name:"total_trip_length",label:"Total trips length, Km",field:"total_trip_length"},{name:"travel_time",label:"Travel Time",field:"travel_time"},{name:"average_speed",label:"Average Speed [km/hr]",field:"average_speed"},{name:"max_speed",label:"Max. Speed [km/hr]",field:"max_speed"},{name:"stop_duration",label:"Stop Duration",field:"stop_duration"}],k=p({data(){return{rows:[],columns:x,loading:!0}},async mounted(){let s=_.findIn(this.getReports.activeReports),r=s[s.findIndex(o=>o.title==="Trip report")];if(r.sheets=="Exceeded Memory Limit"&&await h.report.retreiveReport(r.id).then(o=>{r=o.report}),r){let o=r.sheets;for(let l=1;l<r.sheets.length;l++){this.rows.push({asset_name:o[l].header,date:"",driver_name:"",movement_start:"",movement_end:"",total_trip_length:"",travel_time:"",average_speed:"",max_speed:"",stop_duration:""});let t=o[l].sections[0].data;for(let e=0;e<t.length;e++){this.rows.push({asset_name:o[l].header,date:t[e].header,driver_name:o[l].sections[0].header,movement_start:"",movement_end:"",total_trip_length:"",travel_time:"",average_speed:"",max_speed:"",stop_duration:""});for(let a=0;a<t[e].rows.length;a++)this.rows.push({asset_name:"",date:"",driver_name:"",movement_start:t[e].rows[a].from.v,movement_end:t[e].rows[a].to.v,total_trip_length:t[e].rows[a].length.v,travel_time:t[e].rows[a].time.v,average_speed:t[e].rows[a].avg_speed.v,max_speed:t[e].rows[a].max_speed.v,stop_duration:t[e].rows[a].idle_duration.v})}}}this.loading=!1},computed:{...v("reports",["getReports"])},methods:{...c("reports",["retreiveReport"]),exportTable(){let s=[];for(let t in this.rows){let e=[];for(let a in this.columns)e[this.columns[a].label]=this.rows[t][this.columns[a].field];s.push(e)}let r="Trip Report.xlsx",o=XLSX.utils.json_to_sheet(s),l=XLSX.utils.book_new();XLSX.utils.book_append_sheet(l,o,"myWorkSheet"),XLSX.writeFile(l,r)}}}),y={class:"full-width q-mt-md",align:"right"},R={class:"full-screen fit-screen-content"};function S(s,r,o,l,t,e){return u(),f(w,null,[n("div",y,[i(m,{flat:"",onClick:r[0]||(r[0]=a=>this.$router.push("/home")),icon:"keyboard_arrow_left",class:"text-positive",title:"Back"})]),n("div",R,[i(b,{title:"Trip Report",rows:s.rows,columns:s.columns,"row-key":"asset_name",class:"sticky-column","rows-per-page-options":[20,100,200,1e3],loading:s.loading,"virtual-scroll":""},{"top-right":g(()=>[i(m,{color:"primary","icon-right":"archive",label:"Export to xls","no-caps":"",onClick:s.exportTable},null,8,["onClick"])]),_:1},8,["rows","columns","loading"])])],64)}var C=d(k,[["render",S]]);export{C as default};

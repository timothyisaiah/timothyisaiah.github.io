import{_ as O,e as T,ao as Y,aM as w,m as j,f as Q,aN as V,aO as $,o as z,k as A,w as S,j as B,n as _,Q as b}from"./index.bd67c83e.js";import{Q as K}from"./QTable.b93f300b.js";import{Q as L}from"./QPage.5d3605d6.js";import"./QItem.6176c4fe.js";import"./rtl.b51694b1.js";import"./position-engine.02defa19.js";import"./selection.ee301375.js";import"./format.865294d5.js";const W=[{name:"asset_name",label:"Asset Name",field:"asset_name"},{name:"driver_name",label:"Driver Name",field:"driver_name"},{name:"mileage_covered",label:"Mileage covered (KM)",field:"mileage_covered"},{name:"engine_runtime",label:"Engine Runtime [HH:mm:ss]",field:"engine_runtime"},{name:"idling_time",label:"Idling Time [HH:mm:ss]",field:"idling_time"},{name:"driving_time",label:"Driving Time [HH:mm:ss]",field:"driving_time"},{name:"parking_time",label:"Parking Time [HH:mm:ss]",field:"parking_time"},{name:"asset_utilization",label:"Asset Utilization [%]",field:"asset_utilization"},{name:"weekend_driving",label:"Weekend Driving",field:"weekend_driving"},{name:"weekend_mileage_covered",label:"Weekend Mileage Covered [Km]",field:"weekend_mileage_covered"},{name:"night_driving",label:"Night Driving",field:"night_driving"},{name:"night_mileage_covered",label:"Night Mileage Covered [Km]",field:"night_mileage_covered"},{name:"early_morning_driving",label:"Early Morning Driving",field:"early_morning_driving"},{name:"early_morning_mileage_covered",label:"Ealy Morning Mileage Covered [Km]",field:"early_morning_mileage_covered"},{name:"geofence_exit",label:"Geofence Exit/Entry",field:"geofence_exit"}],G=T({data(){return{columns:W,rows:[],loading:!0}},async mounted(){let n=Y.findIn(this.getReports.activeReports),t=n[n.findIndex(e=>e.title==="Trip report")];(t&&t.sheets=="Exceeded Memory Limit"||t.sheets==null)&&await w.report.retreiveReport(t.id).then(e=>{t=e.report}).catch(e=>{t=null});let o=n[n.findIndex(e=>e.title==="Engine hours report")];(o&&o.sheets=="Exceeded Memory Limit"||o.sheets==null)&&await w.report.retreiveReport(o.id).then(e=>{o=e.report}).catch(e=>{o=null});let d=n[n.findIndex(e=>e.title==="Geofence entry/exit events")];if((d&&d.sheets=="Exceeded Memory Limit"||d.sheets==null)&&await w.report.retreiveReport(d.id).then(e=>{d=e.report}).catch(e=>{d=null}),t&&o&&o.sheets[0].header!="No data found"&&t.sheets[0].header!="No data found"){let e=[],s=t.sheets[0].sections[0].data;o.sheets[0].sections[0].data?e=o.sheets[0].sections[0].data[0].rows:e.push(o.sheets[0].sections[3].data[0].total);let g=this.dateDiffInDays(t.from,t.to,"days");for(let r=0;r<e.length;r++){let a=s[r].header;e.length==1&&(a=o.sheets[0].header,s=t.sheets[0].sections[1].data[0].rows);let p=e.length>1&&s[r].rows[0].object?s[r].rows[0].object.v:e.length==1?t.sheets[0].sections[0].header:"Unidentified driver";if(e.length>1&&s[r].rows.length>1)for(let i in s[r].rows)p=s[r].rows[i].object&&s[r].rows[i].object.v!=="Unidentified driver"?s[r].rows[i].object.v:p;let h=e.length>1?s[r].rows[0].length:s[r].length,c=this.formatInHHMMSS(e[r].in_movement.raw!=null?e[r].in_movement.v:"00:00:00",e[r].idle.raw!=null?e[r].idle.v:"00:00:00"),f=(e[r].in_movement.raw,e[r].idle.raw),E=e[r].idle.v,H=e[r].in_movement.v,D=e.length>1?s[r].rows[0].idle_duration.v:s[r].idle_duration.v,F=Number(f/(12*60*60*g)*100).toFixed(2),y,I,M,k,x=0,N=0,C=0,u=0,R=0,v=0;if(t.sheets.findIndex(i=>i.header===a)>-1){let i=t.sheets[t.sheets.findIndex(l=>l.header===a)].sections[0].data;for(let l in i){if((i[l].header.includes("Sun")||i[l].header.includes("Sat"))&&(x+=parseInt(i[l].header.split(":")[1].trim()),i[l].rows.length>0))for(let m in i[l].rows)N+=i[l].rows[m].length.raw;if(i[l].rows.length>0)for(let m in i[l].rows)(parseInt(i[l].rows[m].from.v.split(":")[0])>19&&parseInt(i[l].rows[m].from.v.split(":")[0])<24||parseInt(i[l].rows[m].to.v.split(":")[0])>20&&parseInt(i[l].rows[m].to.v.split(":")[0])<24)&&(C++,u+=i[l].rows[m].length.raw),(parseInt(i[l].rows[m].from.v.split(":")[0])>=0&&parseInt(i[l].rows[m].from.v.split(":")[0])<6||parseInt(i[l].rows[m].to.v.split(":")[0])>0&&parseInt(i[l].rows[m].to.v.split(":")[0])<6)&&(R++,v+=i[l].rows[m].length.raw)}}y=Number(N).toFixed(2),I=x>0?"YES":"NO",u=Number(u).toFixed(2),M=C>0?"YES":"NO",v=Number(v).toFixed(2),k=R>0?"YES":"NO",this.rows.push({asset_name:a,driver_name:p,mileage_covered:h.v,engine_runtime:c,idling_time:E,driving_time:H,parking_time:D,asset_utilization:F,weekend_driving:I,weekend_mileage_covered:y,night_driving:M,night_mileage_covered:u,early_morning_driving:k,early_morning_mileage_covered:v,geofence_exit:d&&d.sheets.findIndex(i=>i.header===a)!==-1?"YES":"NO"})}}this.loading=!1},computed:{...j("reports",["getReports"])},methods:{...Q("reports",["retreiveReport"]),dateDiffInDays(n,t,o){let d=1e3,e=d*60,s=e*60,g=s*24,r=g*7;n=new Date(n),t=new Date(t);let a=t-n;if(isNaN(a))return NaN;switch(o){case"years":return t.getFullYear()-n.getFullYear();case"months":return t.getFullYear()*12+t.getMonth()-(n.getFullYear()*12+n.getMonth());case"weeks":return Math.floor(a/r);case"days":return Math.floor(a/g);case"hours":return Math.floor(a/s);case"minutes":return Math.floor(a/e);case"seconds":return Math.floor(a/d);default:return}},formatInHHMMSS(n,t){let o=parseInt(n.split(":")[2]),d=parseInt(n.split(":")[1]),e=parseInt(n.split(":")[0]),s=parseInt(t.split(":")[2]),g=parseInt(t.split(":")[1]),r=parseInt(t.split(":")[0]),a=0,p=0,h=o+s;h>59&&(h=h%60,a=1);let c=d+g+a;c>59&&(c=c%60,p=1);let f=e+r+p;return Number.isNaN(f)?n:f+":"+c+":"+h},exportTable(){V(this.columns,this.rows,"Fleet Operations Report.xlsx")},exportCSV(){$(this.columns,this.rows,"Fuel Report.csv")}}}),U={class:"full-width q-mt-md",align:"right"};function q(n,t,o,d,e,s){return z(),A(L,{class:"full-screen bg-white"},{default:S(()=>[B("div",U,[_(b,{flat:"",onClick:t[0]||(t[0]=g=>this.$router.push("/home")),icon:"keyboard_arrow_left",class:"text-positive",title:"Back"})]),_(K,{title:"Fleet Operations Report",rows:n.rows,columns:n.columns,"row-key":"asset_name",class:"sticky-column","rows-per-page-options":[10,20],loading:n.loading},{"top-right":S(()=>[_(b,{color:"primary",icon:"download",label:"xls","no-caps":"",onClick:n.exportTable},null,8,["onClick"]),_(b,{color:"primary",icon:"download",label:"csv","no-caps":"",class:"q-mx-sm",onClick:n.exportCSV},null,8,["onClick"])]),_:1},8,["rows","columns","loading"])]),_:1})}var ne=O(G,[["render",q]]);export{ne as default};

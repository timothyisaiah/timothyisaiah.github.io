import{_ as d,e as p,ao as _,aL as h,m as v,f as c,o as u,i as f,j as n,n as i,Q as m,w as g,F as w}from"./index.a5b922b1.js";import{Q as b}from"./QTable.87403b79.js";import"./QItem.e2537340.js";import"./position-engine.1ee11c05.js";import"./format.865294d5.js";const x=[{name:"asset_name",label:"Asset Name",field:"asset_name"},{name:"date",label:"Date",field:"date"},{name:"driver_name",label:"Driver Name",field:"driver_name"},{name:"movement_start",label:"Movement Start",field:"movement_start"},{name:"movement_end",label:"Movement End",field:"movement_end"},{name:"total_trip_length",label:"Total trips length, Km",field:"total_trip_length"},{name:"travel_time",label:"Travel Time",field:"travel_time"},{name:"average_speed",label:"Average Speed [km/hr]",field:"average_speed"},{name:"max_speed",label:"Max. Speed [km/hr]",field:"max_speed"},{name:"stop_duration",label:"Stop Duration",field:"stop_duration"}],k=p({data(){return{rows:[],columns:x,loading:!0}},async mounted(){let s=_.findIn(this.getReports.activeReports),t=s[s.findIndex(r=>r.title==="Trip report")];if(t&&t.sheets=="Exceeded Memory Limit"&&await h.report.retreiveReport(t.id).then(r=>{t=r.report}),t&&t.sheets[0].header!="No data found"){let r=t.sheets;for(let l=1;l<t.sheets.length;l++){this.rows.push({asset_name:r[l].header,date:"",driver_name:"",movement_start:"",movement_end:"",total_trip_length:"",travel_time:"",average_speed:"",max_speed:"",stop_duration:""});let a=r[l].sections[0].data;for(let e=0;e<a.length;e++){this.rows.push({asset_name:r[l].header,date:a[e].header,driver_name:r[l].sections[0].header,movement_start:"",movement_end:"",total_trip_length:"",travel_time:"",average_speed:"",max_speed:"",stop_duration:""});for(let o=0;o<a[e].rows.length;o++)this.rows.push({asset_name:"",date:"",driver_name:"",movement_start:a[e].rows[o].from.v,movement_end:a[e].rows[o].to.v,total_trip_length:a[e].rows[o].length.v,travel_time:a[e].rows[o].time.v,average_speed:a[e].rows[o].avg_speed.v,max_speed:a[e].rows[o].max_speed.v,stop_duration:a[e].rows[o].idle_duration.v})}}}this.loading=!1},computed:{...v("reports",["getReports"])},methods:{...c("reports",["retreiveReport"]),exportTable(){let s=[];for(let a in this.rows){let e=[];for(let o in this.columns)e[this.columns[o].label]=this.rows[a][this.columns[o].field];s.push(e)}let t="Trip Report.xlsx",r=XLSX.utils.json_to_sheet(s),l=XLSX.utils.book_new();XLSX.utils.book_append_sheet(l,r,"myWorkSheet"),XLSX.writeFile(l,t)}}}),y={class:"full-width q-mt-md",align:"right"},R={class:"full-screen fit-screen-content"};function S(s,t,r,l,a,e){return u(),f(w,null,[n("div",y,[i(m,{flat:"",onClick:t[0]||(t[0]=o=>this.$router.push("/home")),icon:"keyboard_arrow_left",class:"text-positive",title:"Back"})]),n("div",R,[i(b,{title:"Trip Report",rows:s.rows,columns:s.columns,"row-key":"asset_name",class:"sticky-column","rows-per-page-options":[20,100,200,1e3],loading:s.loading,"virtual-scroll":""},{"top-right":g(()=>[i(m,{color:"primary","icon-right":"archive",label:"Export to xls","no-caps":"",onClick:s.exportTable},null,8,["onClick"])]),_:1},8,["rows","columns","loading"])])],64)}var C=d(k,[["render",S]]);export{C as default};

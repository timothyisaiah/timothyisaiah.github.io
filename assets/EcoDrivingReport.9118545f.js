import{_ as b,e as k,ao as C,aM as w,m as R,aN as E,aO as y,o as D,i as N,j as I,n as p,Q as x,w as S,F as T}from"./index.adcf3461.js";import{Q as M}from"./QTable.869613f0.js";import"./QItem.63cc70ca.js";import"./rtl.b51694b1.js";import"./position-engine.f7a12acb.js";import"./selection.e911660f.js";import"./format.865294d5.js";const $=[{name:"asset_name",label:"Asset Name",field:"asset_name"},{name:"driver_name",label:"Driver Name",field:"driver_name"},{name:"max_speed",label:"MaxSpeed [Km/hr]",field:"max_speed"},{name:"time",label:"Time",field:"time"},{name:"over_speeding_count",label:"Over Speeding Count",field:"over_speeding_count"},{name:"address",label:"Address",field:"address"},{name:"harsh_driving",label:"Harsh Driving",field:"harsh_driving"},{name:"harsh_driving_count",label:"Harsh Driving Count",field:"harsh_driving_count"},{name:"accident",label:"Accident",field:"accident"},{name:"driver_performance",label:"Driver / Vehicle Performance",field:"driver_performance"}],B=k({data(){return{columns:$,rows:[],loading:!0}},async mounted(){let t=C.findIn(this.getReports.activeReports),r=t[t.findIndex(e=>e.title==="Eco-driving report")];(r&&r.sheets=="Exceeded Memory Limit"||r.sheets==null)&&await w.report.retreiveReport(r.id).then(e=>{r=e.report}).catch(e=>{r=null});let s=t[t.findIndex(e=>e.title==="Speed violation report")];if((s&&s.sheets=="Exceeded Memory Limit"||s.sheets==null)&&await w.report.retreiveReport(s.id).then(e=>{s=e.report}).catch(e=>{s=null}),r&&s&&r.sheets[0].header!="No data found"){let e=r.sheets,a=s.sheets;for(let i=1;i<e.length;i++){let h=e[i].header,v,n,f,g,l,c,m,u,_,o=a.findIndex(d=>d.header===h);o>=0?(v=a[o].sections[0].text.replace(a[o].sections[2].header,""),n=this.getMax(a[o].sections[2].data[0].rows),_=a[o].sections[2].data[0].rows.length,f=a[o].sections[2].data[0].rows[a[o].sections[2].data[0].rows.findIndex(d=>d.max_speed.raw===n)].max_speed_address.v,g=a[o].sections[2].data[0].rows[a[o].sections[2].data[0].rows.findIndex(d=>d.max_speed.raw===n)].start_time.v,l=e[i].sections[1].rows[2].v,c=l!==void 0?"YES":"NO",m=e[i].sections[1].rows[0].v,u="NO"):(v="Unidentified driver",n=0,n="-",_=0,f="-",g="-",e[i].sections.length>1?(l=e[i].sections[1].rows[2].v,c=l!==void 0?"YES":"NO",m=e[i].sections[1].rows[0].v):(l="-",c="-",m="-"),u="-"),this.rows.push({asset_name:h,driver_name:v,max_speed:n,time:g,over_speeding_count:_,address:f,harsh_driving:c,harsh_driving_count:l,accident:u,driver_performance:m})}}this.loading=!1},computed:{...R("reports",["getReports"])},methods:{getMax(t){for(var r,s=0;s<t.length;s++)(r==null||parseInt(t[s].max_speed.raw)>parseInt(r))&&(r=t[s].max_speed.raw);return r},exportTable(){E(this.columns,this.rows,"Eco Driving Report.xlsx")},exportCSV(){y(this.columns,this.rows,"Eco Driving Report.csv")}}}),O={class:"full-width q-mt-md",align:"right"};function V(t,r,s,e,a,i){return D(),N(T,null,[I("div",O,[p(x,{flat:"",onClick:r[0]||(r[0]=h=>this.$router.push("/home")),icon:"keyboard_arrow_left",class:"text-positive",title:"Back"})]),p(M,{title:"Eco Driving Report",rows:t.rows,columns:t.columns,"row-key":"asset_name",class:"sticky-column","rows-per-page-options":[10,20],loading:t.loading},{"top-right":S(()=>[p(x,{color:"primary","icon-right":"download",label:"xls","no-caps":"",onClick:t.exportTable},null,8,["onClick"]),p(x,{color:"primary","icon-right":"download",label:"csv","no-caps":"",onClick:t.exportTable,class:"q-mx-sm"},null,8,["onClick"])]),_:1},8,["rows","columns","loading"])],64)}var j=b(B,[["render",V]]);export{j as default};

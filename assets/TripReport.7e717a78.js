import{_,e as h,ao as w,aM as c,m as f,f as g,aN as b,aO as y,r as x,o as T,i as k,j as d,n,Q as m,w as i,ar as R,F as S}from"./index.adcf3461.js";import{Q as V,a as C,b as p,c as u}from"./QTabPanels.9cfa2542.js";import{Q as v}from"./QTable.869613f0.js";import"./QResizeObserver.f63be136.js";import"./rtl.b51694b1.js";import"./touch.70a9dd44.js";import"./selection.e911660f.js";import"./use-cache.b0833c75.js";import"./QItem.63cc70ca.js";import"./position-engine.f7a12acb.js";import"./format.865294d5.js";const Q=[{name:"asset_name",label:"Asset Name",field:"asset_name"},{name:"date",label:"Date",field:"date"},{name:"driver_name",label:"Driver Name",field:"driver_name"},{name:"movement_start",label:"Movement Start",field:"movement_start"},{name:"movement_end",label:"Movement End",field:"movement_end"},{name:"total_trip_length",label:"Total trips length, Km",field:"total_trip_length"},{name:"travel_time",label:"Travel Time",field:"travel_time"},{name:"average_speed",label:"Average Speed [km/hr]",field:"average_speed"},{name:"max_speed",label:"Max. Speed [km/hr]",field:"max_speed"},{name:"stop_duration",label:"Stop Duration",field:"stop_duration"}],$=[{name:"asset_name",label:"Asset Name",field:"asset_name"},{name:"trips",label:"Trips",field:"trips"},{name:"trips_length",label:"Total trips Length, km",field:"trips_length"},{name:"travel_time",label:"Travel Time",field:"travel_time"},{name:"average_speed",label:"Average speed, km/h",field:"average_speed"},{name:"max_speed",label:"Max speed, km/h",field:"max_speed"},{name:"idle_duration",label:"Stop duration",field:"idle_duration"},{name:"sensor_all",label:"Fuel consumed by sensors, L",field:"sensor_all"}],j=h({data(){return{rows:[],columns:Q,summary_rows:[],summary_columns:$,loading:!0}},async mounted(){let r=w.findIn(this.getReports.activeReports),a=r[r.findIndex(l=>l.title==="Trip report")];if((a&&a.sheets=="Exceeded Memory Limit"||a.sheets==null)&&await c.report.retreiveReport(a.id).then(l=>{a=l.report}).catch(l=>{a=null}),a&&a.sheets[0].header!="No data found"){let l=a.sheets;if(l.length>1)for(let e=1;e<a.sheets.length;e++){let s=l[e].sections[0].data;for(let t=0;t<s.length;t++)for(let o=0;o<s[t].rows.length;o++)this.rows.push({asset_name:l[e].header,date:s[t].header,driver_name:l[e].sections[0].header,movement_start:s[t].rows[o].from.v,movement_end:s[t].rows[o].to.v,total_trip_length:s[t].rows[o].length.v,travel_time:s[t].rows[o].time.v,average_speed:s[t].rows[o].avg_speed.v,max_speed:s[t].rows[o].max_speed.v,stop_duration:s[t].rows[o].idle_duration.v})}else{let e=l[0].sections[0].data;for(let s=0;s<e.length;s++)for(let t=0;t<e[s].rows.length;t++)this.rows.push({asset_name:l[0].header,date:e[s].header,driver_name:l[0].sections[0].header,movement_start:e[s].rows[t].from.v,movement_end:e[s].rows[t].to.v,total_trip_length:e[s].rows[t].length.v,travel_time:e[s].rows[t].time.v,average_speed:e[s].rows[t].avg_speed.v,max_speed:e[s].rows[t].max_speed.v,stop_duration:e[s].rows[t].idle_duration.v})}if(a.sheets.length>1){let e=a.sheets[0].sections[0].data;for(let s in e)this.summary_rows.push({asset_name:e[s].header,driver_name:e[s].rows[0].object.v,trips:e[s].rows[0].count.v,trips_length:e[s].rows[0].length.v,travel_time:e[s].rows[0].time.v,average_speed:e[s].rows[0].avg_speed.v,max_speed:e[s].rows[0].max_speed.v,idle_duration:e[s].rows[0].idle_duration.v,sensor_all:e[s].rows[0].sensor_all?e[s].rows[0].sensor_all.v:e[s].rows[0][Object.keys(e[s].rows[0])[Object.keys(e[s].rows[0]).findIndex(t=>t.includes("sensor"))]].v})}else{let e=a.sheets[0].sections[1].data[0].rows[0];this.summary_rows.push({asset_name:a.sheets[0].header,driver_name:e.driver.v,trips:e.count.v,trips_length:e.length.v,travel_time:e.time.v,average_speed:e.avg_speed.v,max_speed:e.max_speed.v,idle_duration:e.idle_duration.v,sensor_all:e.sensor_all?e.sensor_all.v:e[Object.keys(e)[Object.keys(e).findIndex(s=>s.includes("sensor"))]].v})}}this.loading=!1},computed:{...f("reports",["getReports"])},methods:{...g("reports",["retreiveReport"]),exportTable(r){let a=r==="summary"?this.summary_rows:this.rows,l=r==="summary"?this.summary_columns:this.columns;b(l,a,"Trip Report.xlsx")},exportCSV(r){let a=r==="summary"?this.summary_rows:this.rows,l=r==="summary"?this.summary_columns:this.columns;y(l,a,"Trip Report.csv")}},setup(){return{tab:x("summary")}}}),N={class:"full-width q-mt-md",align:"right"},D={class:"full-screen fit-screen-content"};function M(r,a,l,e,s,t){return T(),k(S,null,[d("div",N,[n(m,{flat:"",onClick:a[0]||(a[0]=o=>this.$router.push("/home")),icon:"keyboard_arrow_left",class:"text-positive",title:"Back"})]),d("div",D,[n(V,{modelValue:r.tab,"onUpdate:modelValue":a[1]||(a[1]=o=>r.tab=o),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:i(()=>[n(p,{name:"summary",label:"Summary"}),n(p,{name:"detailed",label:"Detailed"})]),_:1},8,["modelValue"]),n(R),n(C,{modelValue:r.tab,"onUpdate:modelValue":a[6]||(a[6]=o=>r.tab=o),animated:"",class:"full-width"},{default:i(()=>[n(u,{name:"summary"},{default:i(()=>[n(v,{title:"Trip Report Summary",rows:r.summary_rows,columns:r.summary_columns,"row-key":"asset_name",class:"sticky-column","rows-per-page-options":[20,100,200,1e3],loading:r.loading,"virtual-scroll":""},{"top-right":i(()=>[n(m,{color:"primary","icon-right":"download",label:"xls","no-caps":"",onClick:a[2]||(a[2]=o=>r.exportTable("summary"))}),n(m,{color:"primary","icon-right":"download",label:"csv","no-caps":"",class:"q-mx-sm",onClick:a[3]||(a[3]=o=>r.exportCSV("summary"))})]),_:1},8,["rows","columns","loading"])]),_:1}),n(u,{name:"detailed",class:"full-width"},{default:i(()=>[n(v,{title:"Trip Report",rows:r.rows,columns:r.columns,"row-key":"asset_name",class:"sticky-column","rows-per-page-options":[20,100,200,1e3],loading:r.loading,"virtual-scroll":""},{"top-right":i(()=>[n(m,{color:"primary","icon-right":"download",label:"xls","no-caps":"",onClick:a[4]||(a[4]=o=>r.exportTable("detailed"))}),n(m,{color:"primary","icon-right":"download",label:"csv","no-caps":"",class:"q-mx-sm",onClick:a[5]||(a[5]=o=>r.exportTable("detailed"))})]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1},8,["modelValue"])])],64)}var K=_(j,[["render",M]]);export{K as default};
